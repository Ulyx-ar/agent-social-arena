'use strict';

var kit = require('@solana/kit');
var system = require('@solana-program/system');
var types = require('./types.cjs');

const makeCreateSmartTransactionWithTip = (createSmartTransaction) => {
    const createWithTip = async (args) => {
        const feePayer = typeof args.feePayer === "string"
            ? args.signers.find((s) => s.address === args.feePayer)
            : (args.feePayer ?? args.signers[0]);
        if (!feePayer) {
            throw new Error("createSmartTransactionWithTip: could not resolve a fee payer signer");
        }
        // Random tip account to avoid CU lockouts
        const randomTipAccount = types.SENDER_TIP_ACCOUNTS[Math.floor(Math.random() * types.SENDER_TIP_ACCOUNTS.length)];
        const tipIx = system.getTransferSolInstruction({
            source: feePayer,
            destination: randomTipAccount,
            amount: kit.lamports(BigInt(args.tipAmount ?? 500000)),
        });
        return createSmartTransaction({
            ...args,
            // Append tip IX so it appears before user instructions
            instructions: [...args.instructions, tipIx],
        });
    };
    return { create: createWithTip };
};

exports.makeCreateSmartTransactionWithTip = makeCreateSmartTransactionWithTip;
//# sourceMappingURL=createSmartTransactionWithTip.cjs.map
