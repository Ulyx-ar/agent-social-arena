'use strict';

var kit = require('@solana/kit');
var pollTransactionConfirmation = require('./pollTransactionConfirmation.cjs');
var types = require('./types.cjs');
var sendViaSender = require('./sendViaSender.cjs');
var determineTip = require('./determineTip.cjs');

const DEFAULT_TIMEOUT_MS = 60000;
const DEFAULT_POLL_MS = 2000;
const makeSendTransactionWithSender = (deps) => {
    const { raw, createSmartTransactionWithTip } = deps;
    const poll = pollTransactionConfirmation.makePollTransactionConfirmation(raw);
    const send = async ({ region, swqosOnly = false, pollTimeoutMs = DEFAULT_TIMEOUT_MS, pollIntervalMs = DEFAULT_POLL_MS, tipAmount, ...builderArgs }) => {
        if (!region)
            throw new Error("Sender region must be specified");
        let tipLamports = tipAmount != null ? BigInt(tipAmount) : await determineTip.determineTipSol(swqosOnly);
        const floor = swqosOnly ? types.MIN_TIP_LAMPORTS_SWQOS : types.MIN_TIP_LAMPORTS_DUAL;
        if (tipLamports < floor)
            tipLamports = floor;
        const { signed, lifetime } = await createSmartTransactionWithTip({
            ...builderArgs,
            tipAmount: Number(tipLamports),
        });
        const sig = await sendViaSender.sendViaSender(kit.getBase64EncodedWireTransaction(signed), region, swqosOnly);
        await poll(sig, {
            timeout: pollTimeoutMs,
            interval: pollIntervalMs,
            lastValidBlockHeight: lifetime.lastValidBlockHeight,
        });
        return sig;
    };
    return { send };
};

exports.makeSendTransactionWithSender = makeSendTransactionWithSender;
//# sourceMappingURL=sendTransactionWithSender.cjs.map
