{"version":3,"file":"sendTransactionWithSender.cjs","sources":["../../../../src/transactions/sendTransactionWithSender.ts"],"sourcesContent":["import { getBase64EncodedWireTransaction } from \"@solana/kit\";\nimport { makePollTransactionConfirmation } from \"./pollTransactionConfirmation\";\nimport {\n  MIN_TIP_LAMPORTS_DUAL,\n  MIN_TIP_LAMPORTS_SWQOS,\n  type SendTransactionWithSenderFn,\n  type SendSmartTxSenderDeps,\n} from \"./types\";\nimport { sendViaSender } from \"./sendViaSender\";\nimport { determineTipSol } from \"./determineTip\";\n\nconst DEFAULT_TIMEOUT_MS = 60_000;\nconst DEFAULT_POLL_MS = 2_000;\n\nexport const makeSendTransactionWithSender = (deps: SendSmartTxSenderDeps) => {\n  const { raw, createSmartTransactionWithTip } = deps;\n  const poll = makePollTransactionConfirmation(raw);\n\n  const send: SendTransactionWithSenderFn = async ({\n    region,\n    swqosOnly = false,\n    pollTimeoutMs = DEFAULT_TIMEOUT_MS,\n    pollIntervalMs = DEFAULT_POLL_MS,\n    tipAmount,\n    ...builderArgs\n  }) => {\n    if (!region) throw new Error(\"Sender region must be specified\");\n\n    let tipLamports =\n      tipAmount != null ? BigInt(tipAmount) : await determineTipSol(swqosOnly);\n\n    const floor = swqosOnly ? MIN_TIP_LAMPORTS_SWQOS : MIN_TIP_LAMPORTS_DUAL;\n    if (tipLamports < floor) tipLamports = floor;\n\n    const { signed, lifetime } = await createSmartTransactionWithTip({\n      ...builderArgs,\n      tipAmount: Number(tipLamports),\n    });\n\n    const sig = await sendViaSender(\n      getBase64EncodedWireTransaction(signed),\n      region,\n      swqosOnly\n    );\n\n    await poll(sig, {\n      timeout: pollTimeoutMs,\n      interval: pollIntervalMs,\n      lastValidBlockHeight: lifetime.lastValidBlockHeight,\n    });\n\n    return sig;\n  };\n\n  return { send };\n};\n"],"names":["makePollTransactionConfirmation","determineTipSol","MIN_TIP_LAMPORTS_SWQOS","MIN_TIP_LAMPORTS_DUAL","sendViaSender","getBase64EncodedWireTransaction"],"mappings":";;;;;;;;AAWA,MAAM,kBAAkB,GAAG,KAAM;AACjC,MAAM,eAAe,GAAG,IAAK;AAEtB,MAAM,6BAA6B,GAAG,CAAC,IAA2B,KAAI;AAC3E,IAAA,MAAM,EAAE,GAAG,EAAE,6BAA6B,EAAE,GAAG,IAAI;AACnD,IAAA,MAAM,IAAI,GAAGA,2DAA+B,CAAC,GAAG,CAAC;IAEjD,MAAM,IAAI,GAAgC,OAAO,EAC/C,MAAM,EACN,SAAS,GAAG,KAAK,EACjB,aAAa,GAAG,kBAAkB,EAClC,cAAc,GAAG,eAAe,EAChC,SAAS,EACT,GAAG,WAAW,EACf,KAAI;AACH,QAAA,IAAI,CAAC,MAAM;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC;QAE/D,IAAI,WAAW,GACb,SAAS,IAAI,IAAI,GAAG,MAAM,CAAC,SAAS,CAAC,GAAG,MAAMC,4BAAe,CAAC,SAAS,CAAC;QAE1E,MAAM,KAAK,GAAG,SAAS,GAAGC,4BAAsB,GAAGC,2BAAqB;QACxE,IAAI,WAAW,GAAG,KAAK;YAAE,WAAW,GAAG,KAAK;QAE5C,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,6BAA6B,CAAC;AAC/D,YAAA,GAAG,WAAW;AACd,YAAA,SAAS,EAAE,MAAM,CAAC,WAAW,CAAC;AAC/B,SAAA,CAAC;AAEF,QAAA,MAAM,GAAG,GAAG,MAAMC,2BAAa,CAC7BC,mCAA+B,CAAC,MAAM,CAAC,EACvC,MAAM,EACN,SAAS,CACV;QAED,MAAM,IAAI,CAAC,GAAG,EAAE;AACd,YAAA,OAAO,EAAE,aAAa;AACtB,YAAA,QAAQ,EAAE,cAAc;YACxB,oBAAoB,EAAE,QAAQ,CAAC,oBAAoB;AACpD,SAAA,CAAC;AAEF,QAAA,OAAO,GAAG;AACZ,IAAA,CAAC;IAED,OAAO,EAAE,IAAI,EAAE;AACjB;;;;"}