import { pipe, createTransactionMessage, setTransactionMessageFeePayer, setTransactionMessageLifetimeUsingBlockhash, appendTransactionMessageInstructions, signTransactionMessageWithSigners, getBase64EncodedWireTransaction } from '@solana/kit';
import { getDeactivateInstruction } from '@solana-program/stake';
import { SYSVAR_CLOCK } from './types.js';

const makeCreateUnstakeTransaction = ({ rpc, }) => {
    return async (ownerSigner, stakeAccount) => {
        const deactivateIx = getDeactivateInstruction({
            stake: stakeAccount,
            clockSysvar: SYSVAR_CLOCK,
            stakeAuthority: ownerSigner,
        });
        const { value: blockHeight } = await rpc.getLatestBlockhash().send();
        const msg = pipe(createTransactionMessage({ version: 0 }), (m) => setTransactionMessageFeePayer(ownerSigner.address, m), (m) => setTransactionMessageLifetimeUsingBlockhash(blockHeight, m), (m) => appendTransactionMessageInstructions([deactivateIx], m));
        const signedTx = await signTransactionMessageWithSigners(msg);
        const serializedTx = getBase64EncodedWireTransaction(signedTx);
        return { serializedTx };
    };
};

export { makeCreateUnstakeTransaction };
//# sourceMappingURL=createUnstakeTransaction.js.map
