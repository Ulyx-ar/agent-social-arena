import { getBase64EncodedWireTransaction } from '@solana/kit';
import { makePollTransactionConfirmation } from './pollTransactionConfirmation.js';
import { MIN_TIP_LAMPORTS_SWQOS, MIN_TIP_LAMPORTS_DUAL } from './types.js';
import { sendViaSender } from './sendViaSender.js';
import { determineTipSol } from './determineTip.js';

const DEFAULT_TIMEOUT_MS = 60000;
const DEFAULT_POLL_MS = 2000;
const makeSendTransactionWithSender = (deps) => {
    const { raw, createSmartTransactionWithTip } = deps;
    const poll = makePollTransactionConfirmation(raw);
    const send = async ({ region, swqosOnly = false, pollTimeoutMs = DEFAULT_TIMEOUT_MS, pollIntervalMs = DEFAULT_POLL_MS, tipAmount, ...builderArgs }) => {
        if (!region)
            throw new Error("Sender region must be specified");
        let tipLamports = tipAmount != null ? BigInt(tipAmount) : await determineTipSol(swqosOnly);
        const floor = swqosOnly ? MIN_TIP_LAMPORTS_SWQOS : MIN_TIP_LAMPORTS_DUAL;
        if (tipLamports < floor)
            tipLamports = floor;
        const { signed, lifetime } = await createSmartTransactionWithTip({
            ...builderArgs,
            tipAmount: Number(tipLamports),
        });
        const sig = await sendViaSender(getBase64EncodedWireTransaction(signed), region, swqosOnly);
        await poll(sig, {
            timeout: pollTimeoutMs,
            interval: pollIntervalMs,
            lastValidBlockHeight: lifetime.lastValidBlockHeight,
        });
        return sig;
    };
    return { send };
};

export { makeSendTransactionWithSender };
//# sourceMappingURL=sendTransactionWithSender.js.map
